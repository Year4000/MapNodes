/*
 * Copyright 2016 Year4000. All Rights Reserved.
 */

plugins {
  id 'java'
  id 'idea'
  id 'de.undercouch.download' version '3.2.0'
}

dependencies {
  testCompile 'junit:junit:4.12'
  compile 'net.year4000.utilities:core:master-SNAPSHOT'
  compile 'com.google.inject:guice:4.0'
  compile 'com.flowpowered:flow-math:1.0.3'
  compile 'com.eclipsesource.j2v8:j2v8_linux_x86_64:4.6.0'
  compile 'org.slf4j:slf4j-api:1.7.21'
}

sourceSets.main.resources {
  srcDir "${projectDir}/src/main/js/"
  srcDir "${projectDir}/src/generated/js/"
}

idea.module {
  sourceDirs += file("${projectDir}/src/main/js/")
}

test.testLogging.showStandardStreams = true

// Download and shade Javascript utils that MapNodes needs
task generateJsUtils(dependsOn: 'processResources') {
  def depends = [
    'https://raw.githubusercontent.com/lodash/lodash/4.17.4/dist/lodash.js',
    'https://cdnjs.cloudflare.com/ajax/libs/immutable/3.8.1/immutable.js',
    'https://raw.githubusercontent.com/Olical/EventEmitter/master/EventEmitter.js',
  ]
  // The task to download all needed libs
  download {
    quiet true
    onlyIfNewer true
    src depends
    dest "${projectDir}/src/generated/js/modules/"
  }
}